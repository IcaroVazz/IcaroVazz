name: ğŸ§  Update README with Private Stats

on:
  schedule:
    - cron: '0 6 * * *' # Executa todo dia Ã s 6h (horÃ¡rio UTC)
  workflow_dispatch: # Permite rodar manualmente tambÃ©m

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§© Clonar repositÃ³rio
        uses: actions/checkout@v4

      - name: ğŸ§  Verificar token disponÃ­vel
        run: |
          if [ -z "${{ secrets.GH_TOKEN }}" ]; then
            echo "âŒ ERRO: GH_TOKEN nÃ£o foi encontrado nos segredos do repositÃ³rio."
            exit 1
          else
            echo "âœ… Token encontrado. Continuando execuÃ§Ã£o..."
          fi

      - name: ğŸ”‘ Validar autenticaÃ§Ã£o do token
        run: |
          echo "ğŸ§© Validando token..."
          curl -H "Authorization: token ${{ secrets.GH_TOKEN }}" https://api.github.com/user > user.json
          cat user.json
          if grep -q "Bad credentials" user.json; then
            echo "âŒ Token invÃ¡lido ou expirado. Gere um novo com permissÃµes 'repo' e 'read:user'."
            exit 1
          else
            echo "âœ… Token vÃ¡lido! AutenticaÃ§Ã£o confirmada."
          fi

      - name: ğŸ“Š Gerar GitHub Stats com commits privados
        run: |
          echo "ğŸ”„ Gerando grÃ¡ficos..."
          mkdir -p stats
          curl -o stats/stats.svg "https://github-readme-stats.vercel.app/api?username=IcaroVazz&show_icons=true&theme=tokyonight&count_private=true&include_all_commits=true"
          curl -o stats/streak.svg "https://streak-stats.demolab.com?user=IcaroVazz&theme=tokyonight&hide_border=true"
          curl -o stats/langs.svg "https://github-readme-stats.vercel.app/api/top-langs/?username=IcaroVazz&layout=compact&langs_count=8&theme=tokyonight"
          echo "âœ… GrÃ¡ficos gerados com sucesso!"
          ls -l stats/

      - name: ğŸ“ Atualizar README e commit automÃ¡tico
        run: |
          echo "ğŸ§© Atualizando README..."
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add stats/
          git commit -m "ğŸ“ˆ Atualizar stats automaticamente ($(date '+%d/%m/%Y %H:%M'))" || echo "Nada novo para atualizar."
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}

      - name: âœ… Log final
        run: |
          echo "ğŸš€ Workflow finalizado com sucesso!"
          echo "Se as imagens apareceram na pasta /stats e o token foi validado, commits privados estÃ£o sendo contados."
